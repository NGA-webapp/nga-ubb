{"name":"Nga-ubb","tagline":"a rebuild version of ubb for nga-webapp","body":"# ubb for nga-webapp [![Build Status](https://travis-ci.org/imyelo/nga-ubb.png?branch=master)](https://travis-ci.org/imyelo/nga-ubb)  \r\nnga的ubb设计较为杂乱，其本身的代码不便于移植，与一般的ubb规则也有所不同，所以需要重新设计一套可维护的nga-ubb解析器。以主要用于[nga-webapp](https://github.com/imyelo/nga-webapp)项目。\r\n\r\n## Dependencies\r\n默认前端环境中已包含[seajs](https://github.com/seajs/seajs)。  \r\n测试依赖于[mocha](http://visionmedia.github.com/mocha/) + [chai](http://chaijs.com/api/bdd/) (bdd) + [sinon](http://sinonjs.org/docs/)。  \r\n此外，尽量不依赖任何第三方类库。  \r\n\r\n## Usage\r\n在业务中可以直接使用`require('./index')`调用，该文件会返回一个已经设置好的ubb对象。\r\n\r\nExample:\r\n\r\n    var ubb = require('utils/ubb/index');\r\n    var content = '[h]foobar[/h]......';\r\n    ...\r\n    content = ubb.toHtml(content);\r\n    ...\r\n\r\n\r\n## Test\r\n参考[/test](test)。\r\n\r\n## API\r\n### Ubb\r\nUbb对象位于[/libs/Ubb.js](libs/Ubb.js)，使用`require('./libs/Ubb').Ubb`调用，\r\n并对外部提供三个方法，分别是add，addExtra，toHtml。  \r\n#### 添加普通标签\r\n以下几种形式的标签为标准的ubb标签，可以用add方法进行添加。\r\n\r\n- [**tagName** *attr*=val *attr2*=val2]content[**/tagName**]\r\n- [**tagName** *attr*=val]content[**/tagName**]\r\n- [**tagName** val val2]content[**/tagName**]\r\n- [**tagName** val]content[**/tagName**]\r\n- [**tagName**=val]content[**/tagName**]\r\n- [**tagName**]content[**/tagName**]\r\n- [**tagName** *attr*=val *attr2*=val2]\r\n- [**tagName** *attr*=val]\r\n- [**tagName** val val2]\r\n- [**tagName** val]\r\n- [**tagName**=val]\r\n- [**tagName**]\r\n\r\nadd方法接受一个tag配置对象，包含以下参数\r\n\r\n    tagName: 标签名  \r\n    isPair: 标签是否成对出现  \r\n    parser: 解析该标签的方法，成对标签将传入参数(content, attrs)，而非成对标签则传入参数(attrs)  \r\n    priority: 标签处理优先级，值越大越先处理，可以不填，默认为`1`  \r\n\r\n其中parser传入的attrs参数为以下形式\r\n\r\n    {\r\n      nop: false, // 没有任何属性值\r\n      value: '',  // 当标签格式为[tagName=val]时代表val，否则该值为undefined\r\n      arr: [], // 当标签有属性值且格式不为[tagName=val]时，属性将按顺序存入该数组\r\n      dict: {} // 当标签有属性值且格式不为[tagName=val]时，有属性名的属性将以键值的形式存入该对象\r\n    }\r\n\r\nExample:\r\n\r\n    var ubb = new Ubb();\r\n    ubb.add({\r\n      tagName: 'test',\r\n      isPair: true,\r\n      parser: function (content, attrs) {\r\n        var data = '';\r\n        if (!attrs.nop && ('foo' in attrs.dict)) {\r\n          data = ' data-foo=\"' + attrs.dict.foo + '\"';\r\n        }\r\n        return '<div class=\"test\"' + data + '>' + content + '</div>';\r\n      },\r\n      priority: 2,\r\n    });\r\n\r\n\r\n#### 添加特殊标签\r\n非标准格式的标签，可以用addExtra方法进行添加。如以下例子：\r\n\r\n- `===head===`\r\n- `[s:4]`\r\n- `[@yelo]`\r\n- `<br />`\r\n\r\n是的，`<br/>`也需要使用该方法进行解析。由于在内部执行解析之前，会对内容进行一次编码，过滤危险的字符串，如`<br />`会被转换为`&gt;br /&lt;`，因此需要对原内容中的`<br />`另行处理。\r\n\r\naddExtra方法也接受一个tag配置对象，但与add方法，其包含以下参数\r\n\r\n    regExp: 匹配解析的正则表达式  \r\n    replacement: 替换内容  \r\n    priority: 标签处理优先级，此处与add方法的priority相同，值越大越先处理，可以不填，默认为1  \r\n\r\naddExtra传入的regExp和replacement可以按String.prototype.replace的参数理解。但与String.prototype.replace不同的是addExtra会对内容进行递归处理，从而解析嵌套形式出现的标签。\r\n\r\nExample:\r\n\r\n    var ubb = new Ubb();\r\n    ubb.add({\r\n      regExp: new RegExp(/-=test:(.*?)=-/gi),\r\n      replacement: '<div class=\"test\">$1</div>',\r\n      priority: 2,\r\n    });\r\n\r\n#### 输出解析后的文本\r\n在添加一系列的标签以后，可以通过toHtml方法输出解析后的文本。  \r\n\r\nExample:\r\n\r\n    var ubb = new Ubb();\r\n    var result;\r\n    ... some add or addExtra function\r\n    result = ubb.toHtml('[test]sth here.[/test]');\r\n\r\ntoHtml会按设置的优先级进行排序，并将排序后的标签进行缓存，然后依次进行解析。在下一次调用toHtml时，则直接从缓存中取出按优先级排序的标签，减少排序造成的消耗。  \r\n*若在toHtml执行之后再次执行add或者addExtra操作，则会在下一次解析的时候重新排序。*\r\n\r\n## 标签补全计划\r\nnga标签类型繁多，但实际使用覆盖率低，因此优先处理常用部分。\r\n\r\n+ 所有标签\r\n    - [b] <del>粗体文字</del>\r\n        - <del>基本解析</del>\r\n    - [u] <del>下划线文字</del>\r\n        - <del>基本解析</del>\r\n    - [i] <del>斜体文字</del>\r\n        - <del>基本解析</del>\r\n    - [align] <del>左/中/右对齐</del>\r\n        - <del>基本解析</del>\r\n    - [color] 文字颜色\r\n        - <del>基本解析</del>\r\n        - 重写样式表\r\n    - [size] 文字大小\r\n        - <del>基本解析</del>\r\n        - 重写样式表\r\n        - 限制最大值\r\n    - [font] 文字字体\r\n        - <del>基本解析</del>\r\n        - 重写样式表\r\n    - [del] 删除线\r\n        - <del>基本解析</del>\r\n        - 重写样式表\r\n    - [h] 段落标题\r\n        - <del>基本解析</del>\r\n    - ===h=== 段落标题\r\n        - <del>基本解析</del>\r\n    - [l/r] 左/右浮动\r\n        - <del>基本解析</del>\r\n    - [list] 列表条目\r\n        - <del>基本解析</del>\r\n        - 重写样式表\r\n    - [img] 插入图片\r\n        - <del>基本解析</del>\r\n        - 重写样式表\r\n        - 处理异常\r\n    - [s:] 插入官方表情\r\n        - <del>基本解析</del>\r\n        - 重写文件地址，使用缓存处理\r\n    - [img] 插入额外表情图片\r\n        - 基本解析\r\n        - 重写文件地址，使用缓存处理\r\n    - [quote] 引用文字\r\n        - <del>基本解析</del>\r\n        - 重写样式表\r\n    - [code] 程序代码\r\n        - <del>基本解析</del>\r\n        - 重写样式表\r\n    - [url] 插入链接\r\n    - [tid/pid] 主题/回复\r\n    - [crypt] 插入加密的内容\r\n    - [dice] 投骰子\r\n    - [collapse] 插入折叠的内容\r\n    - [@用户名] 发送提醒\r\n    - [flash] 插入flash(视频)\r\n    - [table] 插入表格\r\n    - [randomblock] 插入随机段落\r\n    - [t.178.com] 引用178尾巴\r\n    - [album] 插入相册\r\n    - [customachieve] 自定义成就\r\n    - [[]] 游戏数据库\r\n    - [armory] 魔兽世界人物信息\r\n    - [url] Diablo3人物信息\r\n\r\n","google":"","note":"Don't delete this file! It's used internally to help with page regeneration."}